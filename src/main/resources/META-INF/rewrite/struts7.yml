#
# Copyright 2026 the original author or authors.
# <p>
# Licensed under the Moderne Source Available License (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# <p>
# https://docs.moderne.io/licensing/moderne-source-available-license
# <p>
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
type: specs.openrewrite.org/v1beta/category
name: Struts 7.0
packageName: org.openrewrite.java.struts.migrate7
description: Migrate to Struts 7.0. The full migration guide can be found [here](https://cwiki.apache.org/confluence/display/WW/Struts+6.x.x+to+7.x.x+migration).
---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.struts.migrate7.MigrateStruts7
displayName: Migrate to Struts 7.0
description: Migrate Struts 6.x to Struts 7.x.
recipeList:
  - org.openrewrite.maven.UpgradeDependencyVersion:
      groupId: org.apache.struts
      artifactId: "*"
      newVersion: 7.x
      overrideManagedVersion: true
  - org.openrewrite.java.struts.migrate7.RenameOpenSymphonyToStruts2
  - org.openrewrite.java.struts.migrate7.UpdateStruts7Constants

  # Required upgrades as of 7.x
  - org.openrewrite.java.migrate.UpgradeToJava17
  - org.openrewrite.java.migrate.jakarta.JakartaEE10

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.struts.migrate7.RenameOpenSymphonyToStruts2
displayName: Rename OpenSymphony / XWork classes to Struts 7 packages
description: Updates classes moved from com.opensymphony.xwork2.* to their new org.apache.struts2.* packages in Struts 7.
recipeList:

  # Core Action & Context: moved under action sub package
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.Action
      newFullyQualifiedTypeName: org.apache.struts2.action.Action

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.ActionChainResult
      newFullyQualifiedTypeName: org.apache.struts2.result.ActionChainResult

  # ext / i18n: moved from com.opensymphony.xwork2 to org.apache.struts2.text
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.TextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.TextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.CompositeTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.CompositeTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.DefaultTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.DefaultTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.LocalizedTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.LocalizedTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.ResourceBundleTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.ResourceBundleTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.TextProviderFactory
      newFullyQualifiedTypeName: org.apache.struts2.text.TextProviderFactory

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.TextProviderSupport
      newFullyQualifiedTypeName: org.apache.struts2.text.TextProviderSupport

  # util â†’ text: moved under action text sub package
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.util.AbstractLocalizedTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.AbstractLocalizedTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.util.GlobalLocalizedTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.GlobalLocalizedTextProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.util.StrutsLocalizedTextProvider
      newFullyQualifiedTypeName: org.apache.struts2.text.StrutsLocalizedTextProvider

  # Locale: moved under action locale sub package
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.DefaultLocaleProvider
      newFullyQualifiedTypeName: org.apache.struts2.locale.DefaultLocaleProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.DefaultLocaleProviderFactory
      newFullyQualifiedTypeName: org.apache.struts2.locale.DefaultLocaleProviderFactory

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.LocaleProvider
      newFullyQualifiedTypeName: org.apache.struts2.locale.LocaleProvider

  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: com.opensymphony.xwork2.LocaleProviderFactory
      newFullyQualifiedTypeName: org.apache.struts2.locale.LocaleProviderFactory

  # Catch-all fallback for remaining OpenSymphony classes
  - org.openrewrite.java.ChangePackage:
      oldPackageName: com.opensymphony.xwork2
      newPackageName: org.apache.struts2
      recursive: true

---
type: specs.openrewrite.org/v1beta/recipe
name: org.openrewrite.java.struts.migrate7.UpdateStruts7Constants
displayName: Align Struts XML constants for Struts 7
description: Updates Struts XML constants that were renamed or tightened in Struts 7.
recipeList:
  - org.openrewrite.xml.ChangeTagAttribute:
      elementName: constant
      attributeName: name
      oldValue: struts.xwork.chaining.copyErrors
      newValue: struts.chaining.copyErrors

  - org.openrewrite.xml.ChangeTagAttribute:
      elementName: constant
      attributeName: name
      oldValue: struts.xwork.chaining.copyFieldErrors
      newValue: struts.chaining.copyFieldErrors

  - org.openrewrite.xml.ChangeTagAttribute:
      elementName: constant
      attributeName: name
      oldValue: struts.xwork.chaining.copyMessages
      newValue: struts.chaining.copyMessages
